suite: test deployment
templates:
  - deployment.yaml
  - configmap.yaml
  - pvc.yaml
tests:
  - it: Should mount volume
    set:
      sharedSecretFiles:
        - name: my-existing-secret
          files:
            - mountPath: /config
    asserts:
      - template: deployment.yaml
        documentIndex: 0
        equal:
          path: spec.template.spec.containers[0].volumeMounts
          value:
            - mountPath: /config
              name: my-existing-secret
              readOnly: true
  - it: Should mount volume with optional subPath
    set:
      sharedSecretFiles:
        - name: my-existing-secret
          files:
            - mountPath: /config/config.yaml
              subPath: config.yml
    asserts:
      - template: deployment.yaml
        documentIndex: 0
        equal:
          path: spec.template.spec.containers[0].volumeMounts
          value:
            - name: my-existing-secret
              mountPath: /config/config.yaml
              subPath: config.yml
              readOnly: true
  - it: Should reference volume
    set:
      sharedSecretFiles:
        - name: my-existing-secret
          files:
            - mountPath: /config/config.yaml
              subPath: config.yml
    asserts:
      - template: deployment.yaml
        documentIndex: 0
        equal:
          path: spec.template.spec.volumes
          value:
            - name: my-existing-secret
              secret:
                secretName: my-existing-secret
